<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dental Clinic Simulation</title>
  <script src="https://cdn.tailwindcss.com?plugins=forms"></script>
</head>
<body class="bg-gray-100 font-sans">

  <div class="max-w-3xl mx-auto p-6">
    <h1 class="text-3xl font-bold text-center text-blue-700 mb-6">ðŸ¦· Dental Clinic Simulation</h1>

    <!-- Input Form -->
    <div class="bg-white p-6 rounded-lg shadow-md mb-6 flex flex-col sm:flex-row gap-4 items-start sm:items-center">
      <div class="flex flex-col gap-2 flex-1">
        <label class="text-gray-700 font-semibold">Number of Patients:</label>
        <input id="patientsInput" type="number" min="1" value="5" class="w-full p-2 border rounded">
      </div>
      <div class="flex flex-col gap-2 flex-1">
        <label class="text-gray-700 font-semibold">Number of Empty Chairs:</label>
        <input id="chairsInput" type="number" min="1" value="3" class="w-full p-2 border rounded">
      </div>
      <div class="flex gap-2 mt-2 sm:mt-0">
        <button id="startBtn" class="bg-teal-900 text-white px-4 py-2 rounded hover:bg-teal-400">Start Simulation</button>
        <button id="historyBtn" class="bg-purple-900 text-white px-4 py-2 rounded hover:bg-purple-400">Show History</button>
        <button id="clearBtn" class="bg-red-900 text-white px-4 py-2 rounded hover:bg-red-400">Clear History</button>
      </div>
    </div>

    <!-- Output Area -->
    <div id="logArea" class="bg-white p-6 rounded-lg shadow-md h-96 overflow-y-auto">
      <p class="text-gray-500">Simulation log will appear here...</p>
    </div>
  </div>

<script>
    const startBtn = document.getElementById("startBtn");
    const historyBtn = document.getElementById("historyBtn");
    const clearBtn = document.getElementById("clearBtn");
    const logArea = document.getElementById("logArea");

    // Load history from localStorage
    let simulationHistory = [];
    if (localStorage.getItem('dentalClinicHistory')) {
      simulationHistory = JSON.parse(localStorage.getItem('dentalClinicHistory'));
    }

    startBtn.addEventListener("click", () => {
      logArea.innerHTML = ""; // clear current log

      const totalPatients = parseInt(document.getElementById("patientsInput").value);
      const totalChairs = parseInt(document.getElementById("chairsInput").value);

      let waitingChairs = 0;
      let patientQueue = [];
      let dentistBusy = false;

      // Temporary log for this simulation
      let currentSimulationLog = [];

      function log(message, type = "default") {
        const p = document.createElement("p");
        p.textContent = message;
        p.className = "mb-1";

        // Color coding
        if (type === "waiting") p.classList.add("text-yellow-600");
        if (type === "leaving") p.classList.add("text-red-600");
        if (type === "treated") p.classList.add("text-green-600");
        if (type === "info") p.classList.add("text-blue-700");

        logArea.appendChild(p);
        logArea.scrollTop = logArea.scrollHeight;

        // Save to current simulation log
        currentSimulationLog.push({ message, type });
      }

      function treatPatient(patient) {
        dentistBusy = true;
        log(`ðŸª¥ Dentist starts treating Patient ${patient}...`, "treated");
        setTimeout(() => {
          log(`âœ… Patient ${patient} has been treated and leaves the clinic.`, "treated");
          dentistBusy = false;

          if (patientQueue.length > 0) {
            const nextPatient = patientQueue.shift();
            treatPatient(nextPatient);
          } else {
            waitingChairs = 0; // reset chairs when done
          }
        }, 1500);
      }

      for (let i = 1; i <= totalPatients; i++) {
        setTimeout(() => {
          if (waitingChairs < totalChairs) {
            if (dentistBusy) {
              waitingChairs++;
              patientQueue.push(i);
              log(`ðŸª‘ Patient ${i} is waiting. Empty chairs left: ${totalChairs - waitingChairs}`, "waiting");
            } else {
              treatPatient(i);
            }
          } else {
            log(`ðŸšª No empty chair! Patient ${i} leaves the clinic.`, "leaving");
          }
        }, i * 1000);
      }

      // Save this simulation to history and localStorage
      setTimeout(() => {
        simulationHistory.push(currentSimulationLog);
        localStorage.setItem('dentalClinicHistory', JSON.stringify(simulationHistory));
      }, (totalPatients + 2) * 1000);
    });

    historyBtn.addEventListener("click", () => {
      logArea.innerHTML = ""; // clear current log
      if (simulationHistory.length === 0) {
        logArea.innerHTML = "<p class='text-gray-500'>No simulation history yet.</p>";
        return;
      }

      simulationHistory.forEach((sim, index) => {
        const title = document.createElement("p");
        title.textContent = `Simulation #${index + 1}`;
        title.className = "font-bold text-blue-700 mt-2 mb-1";
        logArea.appendChild(title);

        sim.forEach(item => {
          const p = document.createElement("p");
          p.textContent = item.message;
          p.className = "mb-1";
          if (item.type === "waiting") p.classList.add("text-yellow-600");
          if (item.type === "leaving") p.classList.add("text-red-600");
          if (item.type === "treated") p.classList.add("text-green-600");
          if (item.type === "info") p.classList.add("text-blue-700");
          logArea.appendChild(p);
        });
      });
    });

    clearBtn.addEventListener("click", () => {
      simulationHistory = [];
      localStorage.removeItem('dentalClinicHistory');
      logArea.innerHTML = "<p class='text-gray-500'>Simulation history cleared.</p>";
    });
  </script>
</body>
</html>